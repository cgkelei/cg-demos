<Effect name="Font">

<Shader name="FontVS" stage="Vertex" entry="main">
<ShaderSource>
<![CDATA[
#version 330

uniform vec2 WindowSize;

in vec3 iPos;
in vec2 iTex;
in vec4 iColor;

out vec2 oTex;
out vec4 oColor;

void main()
{
	vec4 oPos = vec4(iPos, 1.0);
	
	oPos.xy = vec2(2.0 * iPos.x - WindowSize.x,  WindowSize.y - 2.0 * iPos.y ) / WindowSize;
	
	gl_Position = oPos;
	
	oTex = iTex;
	
#ifndef Direct3D	
	oTex.y = 1.0 - oTex.y;
#endif

	oColor = iColor;
}

]]>
</ShaderSource>
</Shader>

<Shader name="FontPS" stage="Pixel" entry="main">
<ShaderSource>
<![CDATA[
uniform sampler2D SpriteTexture;


in vec2 oTex;
in vec4 oColor;

const float Gamma = 2.2;
const float Smoothness = 96.0;

void main()
{
    float dist = texture2D(SpriteTexture, oTex).a;
	
    //float w = fwidth(dist);	
	
	// perform adaptive anti-aliasing of the edges\n
	float w = clamp( Smoothness * (abs(dFdx(oTex.x)) + abs(dFdy(oTex.y))), 0.0, 0.5);
	
	float alpha = smoothstep(0.5-w, 0.5+w, dist);
	alpha = pow(alpha, 1.0/Gamma);
	gl_FragColor = vec4(oColor.xyz, oColor.a * alpha);
}

]]>
</ShaderSource>
</Shader>

<Technique name="FontTech">
	<Pass name="p0">
		<State name="BlendEnable" value="true"/>
		<State name="SrcBlend" value="SrcAlpha"/>
		<State name="DestBlend" value="InvSrcAlpha"/>
		<State name="DepthFunc" value="LessEqual"/>
		<State name="CullMode" value="None"/> 	
		<VertexShader name="FontVS"/>
		<PixelShader name="FontPS"/>			
	</Pass>
</Technique>

</Effect>